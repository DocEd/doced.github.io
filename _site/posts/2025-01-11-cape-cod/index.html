<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ed Palmer">
<meta name="dcterms.date" content="2025-01-11">
<meta name="description" content="In this article I review the evidence behind the CAPE-COD trial, how we might implement this into our practice">

<title>Severe Community Acquired Pneumonia – Ed Palmer</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ed Palmer</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://bsky.app/profile/doced.bsky.social" title="BS" class="quarto-navigation-tool px-1" aria-label="BS"><i class="bi bi-"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://code.com">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://bugs.com">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#trial-overview" id="toc-trial-overview" class="nav-link" data-scroll-target="#trial-overview">Trial Overview</a></li>
  <li><a href="#pico" id="toc-pico" class="nav-link" data-scroll-target="#pico">PICO</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#secondary-outcomes" id="toc-secondary-outcomes" class="nav-link" data-scroll-target="#secondary-outcomes">Secondary Outcomes</a></li>
  <li><a href="#subgroups-of-interest" id="toc-subgroups-of-interest" class="nav-link" data-scroll-target="#subgroups-of-interest">Subgroups of Interest</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">discussion</a>
  <ul class="collapse">
  <li><a href="#integrating-with-other-major-trials" id="toc-integrating-with-other-major-trials" class="nav-link" data-scroll-target="#integrating-with-other-major-trials">Integrating with Other Major Trials</a></li>
  </ul></li>
  <li><a href="#the-acid-test" id="toc-the-acid-test" class="nav-link" data-scroll-target="#the-acid-test">The Acid Test</a></li>
  <li><a href="#wrapping-up" id="toc-wrapping-up" class="nav-link" data-scroll-target="#wrapping-up">Wrapping Up</a>
  <ul class="collapse">
  <li><a href="#putting-it-in-context" id="toc-putting-it-in-context" class="nav-link" data-scroll-target="#putting-it-in-context">Putting it in context</a></li>
  <li><a href="#unanswered-questions" id="toc-unanswered-questions" class="nav-link" data-scroll-target="#unanswered-questions">Unanswered questions</a></li>
  </ul></li>
  <li><a href="#recommendations" id="toc-recommendations" class="nav-link" data-scroll-target="#recommendations">Recommendations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Severe Community Acquired Pneumonia</h1>
<p class="subtitle lead">A deep dive into the CAPE-COD trial</p>
  <div class="quarto-categories">
    <div class="quarto-category">medicine</div>
  </div>
  </div>

<div>
  <div class="description">
    In this article I review the evidence behind the CAPE-COD trial, how we might implement this into our practice
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://doced.github.io/">Ed Palmer</a> <a href="https://orcid.org/0000-0002-8024-4616" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>CAPE-COD was a randomised controlled trial that reported in the NEJM in early 2024. I will assume that the reader has read the trial. But if not, please have a look at the following links:</p>
<ul>
<li>Original link</li>
<li>Bottom line<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> (structured review)</li>
<li>Ed and Todd podcast (narrative review)</li>
</ul>
<p>The steroid evidence landscape in intensive care is complex. Really complex. There are a number of conditions that we encounter in the ICU that may benefit from steroids including septic shock, meningitis and ARDS. The story in community acquired pneumonia is somewhat less clear. A number of small RCTs, which were almost certainly underpowered, have been unable to detect a mortality benefit thus far. And so the stage was set for a larger RCT that was better powered to answer this important question.</p>
<p>Anacdotally, since this trial was announced, I have seen a huge increase in the steroids prescribed for pneumonia. This includes variations in dose, frequency, indication and duration. It seems like word of this trial has entered the medical imagination, and the result is that many more people are getting steroids than were before.</p>
</section>
<section id="trial-overview" class="level1">
<h1>Trial Overview</h1>
<p>This trial was a double blind, placebo controlled, French multi-centre RCT conducted at 31 Centres from 2015 to 2020. Randomisation took place in a 1:1 fashion with blocks across strata (center and use of mechanical ventilation). 1146 patients were needed to provide 80% power to detect a 25% relative risk reduction in mortality from a baseline of 27%. This was rounded up to 1200 to account for loss to follow up.</p>
</section>
<section id="pico" class="level1">
<h1>PICO</h1>
<ul>
<li>Population</li>
<li>Intervention: continuous infusion of hydrocortisone (200 mg / day)</li>
<li>Comparator: matched placebo</li>
<li>Outcomes:
<ul>
<li>Primary: 28 day mortality.</li>
<li>Secondary:</li>
</ul></li>
</ul>
<p>Recruitment was paused at 800 randomised patients; the planned second interim analysis. This coincided with the COVID pandemic, and allowed this group to pivot to investigating hydrocortisone in COVID-19, since the research apparatus already established. After a long (and very understandable pause), the DSMB recommended stopping trial because:</p>
<ol type="1">
<li>Based on available data, equipoise no longer remained between groups</li>
<li>long term suspension of the trial would have unknown impact on analysis</li>
<li>another 400 patients very unlikely to change interpretation of results.</li>
</ol>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>the primary outcome, death from all causes by day 28 was 6.2% in the hydrocortisone arm and 11.9% in the matched placebo arm. This corresponds to a difference of -5.6% (-9.6 to -1.7%), p = 0.006 (chi square). There are a number of secondary outcomes, which I include graphically below.</p>
</section>
<section id="secondary-outcomes" class="level1">
<h1>Secondary Outcomes</h1>
<ul>
<li>No significant difference in
<ul>
<li>Cumulative incidence of hospital acquired infection by day 28: 9.8 vs 11.1%</li>
<li>Cumulative incidence of GI bleeding by day 28: 2.2 vs 3.3%</li>
</ul></li>
<li>Significantly greater in intervention group
<ul>
<li>Median daily dose of insulin by day 7: 35.5 vs 20.0 IU/day</li>
</ul></li>
<li>Significantly less in intervention group
<ul>
<li>Death by day 90: 9.3% vs 14.7%</li>
<li>Cumulative incidence of endotracheal intubation by day 28: 18.0 vs 29.5%</li>
<li>Cumulative incidence of endotracheal intubation by day 28 in those not receiving at baseline: 19.5% vs 27.7%</li>
<li>Cumulative incidence of vasopressor initiation by day 28 in those not receiving at baseline: 15.3 vs 25.0%</li>
</ul></li>
</ul>
</section>
<section id="subgroups-of-interest" class="level1">
<h1>Subgroups of Interest</h1>
</section>
<section id="discussion" class="level1">
<h1>discussion</h1>
<p>There are strong reasons of biological plausibility, that severe bacterial pneumonia would be susceptible to inflammatory modification with steroids. However, there are rightly concerns about potential adverse sequelae of steroid use; overly aggressive immune suppression, hyperglycaemia, improper timing (I.e initiating too soon or too late).</p>
<p>There are several important questions that arise from this trial. Rarely does a trial give us everything we want and this one is no different.</p>
<p>The severity criteria were already quite lax in my view, and I can’t explain the rationale to change the eligibility criteria part way through the trial. I’m not so sure if this truly is a trial of “severe” pneumonia, but rather of pneumonia with an oxygen requirement. Perhaps they are two in the same. Further, these were not very sick patients. The SAPS II and SOFA scores demonstrate that these patients were not very sick. Contrast with other steroid ICU trials. The enrolment criteria were never going to produce a mortality of 25% and indeed, a much lower control group mortality is exactly what we saw.</p>
<p>Further, all these patients were inside the ICU. It’s hard to translate this directly into the UK which by comparison is a resource restricted environment. Many of the patients in this trial would be managed on the ward in UK environment. And so this begs the question, should we start steroids outside the ICU in those eligible?</p>
<p>Although I view the point of admission to the ICU as a largely administrative time point, it does create a different safety profile for the patient, some positive, some negative. For those who think admission to the ICU is a slam dunk positive intervention, I would invite to read ICECUB. Inside the ICU I can site an art line, closely monitor both haemodynamic and gas exchange, and trivially run a variable rate insulin infusion to control hyperglycaemia. This may offer a favourable safety advantage in this context that I can’t replicate on the ward. An infusion of steroid, which may also necessitate an infusion of insulin are simply not realistic. In this context, I think a pragmatic use of QDS hydrocortisone, are reasonable. But this requires buy in from parent teams who will be looking after the patients outside ICU and will have to contend with the inevitable hyperglycaemia.</p>
<p>Does this finding translate to patients who are not candidates for ICU? I would say no. This is a fundamentally different patient population. Typically much more frail, and suspeptqnel to th pe adverse sequelae of steroids, particularly outside the ICU. I just don’t think you can extrapolate that far from this trial.</p>
<section id="integrating-with-other-major-trials" class="level2">
<h2 class="anchored" data-anchor-id="integrating-with-other-major-trials">Integrating with Other Major Trials</h2>
<p>There are two major trials that interact with this one. First, DEXA-ARDS which has several notable flaws. Most strikingly, the lack of appropriate blinding, questions over the way in which allocation concealment was performed and the lack of hyperglycaemia in the treatment arm. With further limitations from the exclusion of patients with prior corticosteroid exposure. While I cannot ignore the findings, and I would certainly administer dexamethasone to patients with established ARDS, I would want another trial to be conducted that essentially bridges these two trials. Essentially a properly blinded ARDS trial, where prior steroid use wasn’t an exclusion criteria. The question would then be, doe s</p>
<p>The second is APROCHSS, which was a double blind randomised control trial investigating the use of hydrocortisone plus fludrocortisone in established septic shock. Briefly, patients in this trial were much sicker, with a minimum noradrenaline requirement of 0.25, commensurate SAPS and SOFA scores, and a control group mortality of xx. Although this was all comers with sepsis, the single largest group would have been severe community acquired pneumonia. Looking at the supplement xx. Again, this study excluded those who were exposed to prior steroids.</p>
<p>There is now an abundance of data to show that steroids in septic shock speed shock resolution, and likely improve mortality.</p>
<p>The third is HYPRESS which used steroids (hydrocortisone only)in sepsis in an attempt to <em>prevent</em> the onset of shock.</p>
<p>Interaction with DNAR orders</p>
</section>
</section>
<section id="the-acid-test" class="level1">
<h1>The Acid Test</h1>
<p>My acid test for interpreting trial literature is whether or not you would want the teatment for yourself or family members. I find it’s a helpful heuristic to follow and challenges us to bridge the gap between our intellectual side (interpreting trial evidence in the cold) and our emotional side (where the stakes are very high). if I had a bacterial pneumonia, with an oxygen requirement, I would want to receive steroids.</p>
</section>
<section id="wrapping-up" class="level1">
<h1>Wrapping Up</h1>
<p>This trial showed that hydrocortisone improved mortality in a population of patients with bacterial pneumonia (most commonly pneumococcus), who were being treated inside an ICU, with an oxygen requirement, and in whom influenza had been excluded. I would apply this to my practice by</p>
<p>I think equipoise remains to repeat this trial in the frail or elderly population who are ineligible for treatment inside the ICU</p>
<section id="putting-it-in-context" class="level2">
<h2 class="anchored" data-anchor-id="putting-it-in-context">Putting it in context</h2>
<ul>
<li>DEXA-ARDS: excluded prior steroids from analysis</li>
</ul>
</section>
<section id="unanswered-questions" class="level2">
<h2 class="anchored" data-anchor-id="unanswered-questions">Unanswered questions</h2>
</section>
</section>
<section id="recommendations" class="level1">
<h1>Recommendations</h1>
<ul>
<li>Hydrocortisone should be administered to patients with severe CAP:
<ul>
<li>who meet inclusion criteria</li>
<li>Are being considered for admission to the ICU (i.e.&nbsp;can start before arrival, and continue in line with this protocol)</li>
<li>Where viral pneumonia has been excluded</li>
</ul></li>
<li>Pragmatically dose at 50 mg QDS</li>
<li>Consider fludocortisone if patient develops septic shock.</li>
<li>Switch to high dose dexamethasone if patient develops severe ARDS.</li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The bottom line offers truly excellent structured abtracts of clinical trials, mostly in intensive care medicine. I often wish that trials for asked to create their own structured reviews following a similar template, perhaps a little like HORIZON review but deeper and more comprehensive. While they excell at the how and the what, I don’t think they go too deeply into the why, and so that is partly why I hope a review of this nature is of additional benefit<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>